---
title: shell中set指令的用法
date: 2018-09-13 23:00:09
categories:
  - "Shell"
tags:
  - "set"
---

#### 语法

```
set [-可选参数] [-o 选项]
```

#### 功能说明

set 指令可根据不同的需求来设置当前所使用 shell 的执行方式，同时也可以用来设置或显示 shell 变量的值。当指定某个单一的选项时将设置 shell 的常用特性，如果在选项后使用 -o 参数将打开特殊特性，若是 +o 将关闭相应的特殊特性。而不带任何参数的 set 指令将显示当前 shell 中的全部变量，且总是返回 true，除非遇到非法的选项。

<!--more-->

------

#### 参数说明

可选参数及其说明如下：

|   参数    | 说明                                                         |
| :-------: | :----------------------------------------------------------- |
|    -a     | 标示已修改的变量，以供输出至环境变量                         |
|    -b     | 使被中止的后台程序立刻回报执行状态                           |
|    -d     | Shell预设会用杂凑表记忆使用过的指令，以加速指令的执行。使用-d参数可取消 |
|  **-e**   | 若指令传回值不等于0，则立即退出shell                         |
|    -f     | 取消使用通配符                                               |
|    -h     | 自动记录函数的所在位置                                       |
|    -k     | 指令所给的参数都会被视为此指令的环境变量                     |
|    -l     | 记录for循环的变量名称                                        |
|    -m     | 使用监视模式                                                 |
|    -n     | 测试模式，只读取指令，而不实际执行                           |
|    -p     | 启动优先顺序模式                                             |
|    -P     | 启动-P参数后，执行指令时，会以实际的文件或目录来取代符号连接 |
|    -t     | 执行完随后的指令，即退出shell                                |
|    -u     | 当执行时使用到未定义过的变量，则显示错误信息                 |
|    -v     | 显示shell所读取的输入值                                      |
| -H shell  | 可利用"!"加<指令编号>的方式来执行 history 中记录的指令       |
|  **-x**   | 执行指令后，会先显示该指令及所下的参数                       |
|  +<参数>  | 取消某个set曾启动的参数。与-<参数>相反                       |
| -o option | 特殊属性有很多，大部分与上面的可选参数功能相同，这里就不列了 |

------

#### 重点参数

最常用的两个参数就是 **-e** 与 **-x** ，一般写在 shell 代码逻辑之前，这两个组合在一起用，可以在 debug 的时候替你节省许多时间 。

- `set -x` 会在执行每一行 shell 脚本时，把执行的内容输出来。它可以让你看到当前执行的情况，里面涉及的变量也会被替换成实际的值。 

- `set -e` 会在执行出错时结束程序，就像其他语言中的“抛出异常”一样。（准确说，不是所有出错的时候都会结束程序，见下面的注） 

  > 注：set -e结束程序的条件比较复杂，在man bash里面，足足用了一段话描述各种情景。大多数执行都会在出错时退出，除非 shell 命令位于以下情况：
  >
  > 1. 一个 pipeline 的非结尾部分，比如error | ok
  > 2. 一个组合语句的非结尾部分，比如ok && error || other
  > 3. 一连串语句的非结尾部分，比如error; ok
  > 4. 位于判断语句内，包括test、if、while等等。

------

#### 其他用法

- **set：初始化位置参数**

  调用 set 是接一个或多个参数时，set 会把参数的值赋予位置参数，从 $1 开始赋值。如下例子：

  ```
  $ cat set-it.sh
  #!/bin/bash
  set first second third
  echo $3 $2 $1
  
  $ ./set-it.sh
  third second first
  ```

  如上，在执行 `set-it.sh` 脚本时并没有输入参数，但是使用 set 指令后会对位置参数进行赋值。

- **set：显示 shell 变量**

  如果不带任何参数的使用 set 命令，set 指令就会显示一列已设置的 shell 变量，包括用户定义的变量和关键字变量。

  ```
  $ set 
  BASH_VERSION='4.2.24(1)-release'
  COLORS=/etc/DIR_COLORS
  MAIL=/var/spool/mail/username
  ...
  ```

------

